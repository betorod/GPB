{% extends "base.html" %}
{% load objlink %}
{% load currency %}

{% block extrajs %}
<script type="text/javascript">

  function draw_table() {
    {{ gasto_por_mes_datatable_js|safe }}
    var date_formatter = new google.visualization.DateFormat({pattern: 'MMMM'});
    date_formatter.format(gasto_por_mes, 0);
    var number_formatter = new google.visualization.NumberFormat({prefix: '$', negativeColor: 'red', negativeParens: true, groupingSymbol:'.', decimalSymbol:','});
    number_formatter = number_formatter.format(gasto_por_mes, 1);

    var linechart = new google.visualization.LineChart(document.getElementById('table_div_jscode'));
    linechart.draw(gasto_por_mes, {showRowNumber: true});
  
    {{reparticion_datatable_js|safe}}
    var piechart = new google.visualization.PieChart(document.getElementById('piechart_div'));
    piechart.draw(reparticion_gastos, {width: 450, height: 300 });

  }

  google.setOnLoadCallback(draw_table);

</script>
{% endblock %}

{% block content %}
<h1>Gasto Público Bahiense</h1>
<hr>
<h2 class="alt">En lo que va del mes de <strong>{% now "F \de Y" %}</strong>, <a href="http://www.bahiablanca.gov.ar">la Municipalidad</a> gastó <strong>{{gasto_mensual_total|currency}}</strong>.</h2>
<hr>
<div class="span-10 colborder">
  <h5>Las 5 reparticiones que más gastaron en {% now "F \de Y" %}</h6>
  <div id="piechart_div"></div> 
  <table class="tabla-sumario">
    <caption>Las 5 reparticiones que más gastaron en {% now "F \de Y" %}</caption>
    <thead>
      <tr>
	<th>Reparticion</th>
	<th>Total</th>
      </tr>
    </thead>
    <tbody>
      {% for r in reparticiones|slice:":5" %}
      <tr>
	<td>{{r|objlink}}</td>
	<td><strong>{{r.total_compras|currency}}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="span-13 last">
  <h5>Los 5 proveedores más beneficiados en {% now "F \de Y" %}</h5>
  <table class="tabla-sumario">
    <caption>Los 5 proveedores más beneficiados en {% now "F \de Y" %}</caption>
    <thead>
      <tr>
	<th>Proveedor</th>
	<th>Total</th>
      </tr>
    </thead>
    <tbody>
      {% for p in proveedores|slice:":5" %}
      <tr>
	<td>{{p|objlink}}</td>
	<td><strong>{{p.total_compras|currency}}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="span-20 last">
  <h3>Gastos del año 2010</h3>
  <div id="table_div_jscode" style="height: 200px; width: 100%"></div>
</div>

{% endblock %}

